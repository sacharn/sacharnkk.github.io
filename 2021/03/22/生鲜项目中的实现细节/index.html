<!DOCTYPE html>
<html  lang="zh-CN" >
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color" content="#fff" id="theme-color">
  <meta name="description" content="Hexo">
  <link rel="icon" href="/img/Kaze.png">
  <title>生鲜项目中的实现细节</title>
  
  
  <meta property="og:title" content="生鲜项目中的实现细节">
  
  
  <meta property="og:url" content="https://sacharn.github.io/2021/03/22/%E7%94%9F%E9%B2%9C%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82/index.html">
  
  
  <meta property="og:img" content="/img/aze.png">
  
  
  
  <meta property="og:type" content="article">
  <meta property="og:article:published_time" content="2021-03-22">
  <meta property="og:article:modified_time" content="2021-03-25">
  <meta property="og:article:author" content="燕树城">
  
  
  
  
  
  <script>
    // control reverse button
    var reverseDarkList = {
      dark: 'light',
      light: 'dark'
    };
    var themeColor = {
      dark: '#1c1c1e',
      light: '#fff'
    }
    // get the data of css prefers-color-scheme
    var getCssMediaQuery = function() {
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    };
    // reverse current darkmode setting function
    var reverseDarkModeSetting = function() {
      var setting = localStorage.getItem('user-color-scheme');
      if(reverseDarkList[setting]) {
        setting = reverseDarkList[setting];
      } else if(setting === null) {
        setting = reverseDarkList[getCssMediaQuery()];
      } else {
        return;
      }
      localStorage.setItem('user-color-scheme', setting);
      return setting;
    };
    // apply current darkmode setting
    var setDarkmode = function(mode) {
      var setting = mode || localStorage.getItem('user-color-scheme');
      if(setting === getCssMediaQuery()) {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[setting];
      } else if(reverseDarkList[setting]) {
        document.documentElement.setAttribute('data-user-color-scheme', setting);
        document.getElementById('theme-color').content = themeColor[setting];
      } else {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[getCssMediaQuery()];
      }
    };
    setDarkmode();
  </script>
  <script>
    function loadScript(url, cb) {
      var script = document.createElement('script');
      script.src = url;
      if (cb) script.onload = cb;
      script.async = true;
      document.body.appendChild(script);
    }
  </script>
  
  <link rel="preload" href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css" as="style" >
  <link rel="preload" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css" as="style" >
  
  <link rel="preload" href="/js/lib/lightbox/baguetteBox.min.js" as="script">
  <link rel="preload" href="/js/lib/lightbox/baguetteBox.min.css" as="style" >
  
  
  <link rel="preload" href="/js/lib/lozad.min.js" as="script">
  
  
  
  
  
  
  
  
<link rel="stylesheet" href="/css/main.css">

  
  
<link rel="stylesheet" href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css">

  
  
<link rel="stylesheet" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css">

  
  
<link rel="stylesheet" href="/js/lib/lightbox/baguetteBox.min.css">

  
  
  
  
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <div class="wrapper">
    
    <nav class="navbar">
  <div class="navbar-logo">
    <span class="navbar-logo-main">
      
      <img class="navbar-logo-img" src="/img/Kaze.png" alt="logo">
      
      <span class="navbar-logo-dsc">燕子坞</span>
    </span>
  </div>
  <div class="navbar-menu">
    
    <a href="/" class="navbar-menu-item">
    
    首页
    
    </a>
    
    <a href="/archives" class="navbar-menu-item">
    
    归档
    
    </a>
    
    <a href="/tags" class="navbar-menu-item">
    
    标签
    
    </a>
    
    <a href="/categories" class="navbar-menu-item">
    
    分类
    
    </a>
    
    <a href="/about" class="navbar-menu-item">
    
    关于
    
    </a>
    
    <a href="/links" class="navbar-menu-item">
    
    友链
    
    </a>
    
    <a class="navbar-menu-item darknavbar" id="dark"><i class="iconfont icon-weather"></i></a>
    <a class="navbar-menu-item searchnavbar" id="search"><i class="iconfont icon-search" style="font-size: 1.2rem; font-weight: 400;"></i></a>
  </div>
</nav>
    
    <div id="local-search" style="display: none;">
      <input class="navbar-menu-item" id="search-input" placeholder="请输入搜索内容...">
      <div id="search-content"></div>
    </div>
    
    <div class="section-wrap">
      <div class="container">
        <div class="columns">
          <main class="main-column">
<article class="card card-content">
  <header>
    <h1 class="post-title">
      生鲜项目中的实现细节
    </h1>
  </header>
  <div class="post-meta post-show-meta">
    <time datetime="2021-03-22T07:35:14.000Z">
      <i class="iconfont icon-calendar" style="margin-right: 2px;"></i>
      <span>2021-03-22</span>
    </time>
    
    
    <span class="dot"></span>
    <span>4.8k 字</span>
    
  </div>
  
  </header>
  <div id="section" class="post-content">
    <h4 id="1、统一异常"><a href="#1、统一异常" class="headerlink" title="1、统一异常"></a>1、统一异常</h4><ul>
<li>我们需要对这些异常进行统一的捕获并处理。SpringBoot中有一个<strong>ControllerAdvice的注解</strong>，<strong>使用该注解表示开启了全局异常的捕获</strong>，我们只需在自定义一个方法使用<strong>ExceptionHandler注解</strong>然后定义<strong>捕获异常的类型</strong>即可<strong>对这些捕获的异常进行统一的处理</strong>。如下为<strong>全局异常处理类</strong>。</li>
</ul>
<pre class="highlight"><span class="line"><span class="keyword">package</span> com.shu.mall.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.shu.mall.common.ApiRestResponse;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.BindingResult;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.ObjectError;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.MethodArgumentNotValidException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用该注解代表开启了全局异常捕获</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger log = LoggerFactory.getLogger(GlobalExceptionHandler.class);</span><br><span class="line">    <span class="comment">//处理默认异常</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">handleException</span><span class="params">(Exception e)</span></span>&#123;</span><br><span class="line">    log.error(<span class="string">&quot;Default Exception:&quot;</span> ,e);</span><br><span class="line">        <span class="keyword">return</span> ApiRestResponse.error(LiveMallExceptionEnum.SYSTEM_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//处理业务相关的自定义异常</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(LiveMallException.class)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">handleLiveMallException</span><span class="params">(LiveMallException e)</span></span>&#123;</span><br><span class="line">        log.error(<span class="string">&quot;LiveMallException:&quot;</span> ,e);</span><br><span class="line">        <span class="keyword">return</span> ApiRestResponse.error(e.getCode(),e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//处理参数校验异常</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApiRestResponse <span class="title">handleMethodArgumentNotValidException</span><span class="params">(MethodArgumentNotValidException e)</span></span>&#123;</span><br><span class="line">        log.error(<span class="string">&quot;MethodArgumentNotValidException:&quot;</span>+e);</span><br><span class="line">        <span class="keyword">return</span> handleBindingResult(e.getBindingResult());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//把异常处理为对外暴露的提示</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ApiRestResponse <span class="title">handleBindingResult</span><span class="params">(BindingResult result)</span></span>&#123; </span><br><span class="line">        List&lt;String&gt; list =<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (result.hasErrors()) &#123;</span><br><span class="line">            List&lt;ObjectError&gt; allErrors = result.getAllErrors();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; allErrors.size(); i++) &#123;</span><br><span class="line">                ObjectError objectError = allErrors.get(i);</span><br><span class="line">                String defaultMessage = objectError.getDefaultMessage();</span><br><span class="line">                list.add(defaultMessage);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (list.size()==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> ApiRestResponse.error(LiveMallExceptionEnum.REQUEST_PARAM_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ApiRestResponse.error(LiveMallExceptionEnum.REQUEST_PARAM_ERROR.getCode(),list.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre>

<ul>
<li>如上图代码可知，需要处理的异常分为默认异常、业务相关的异常和参数校验相关异常。在本项目中，业务相关的异常是LiveMallException异常（继承自RuntimeException），成员变量为状态码和状态信息：</li>
</ul>
<pre class="highlight"><span class="line"><span class="keyword">package</span> com.shu.mall.exception;</span><br><span class="line"></span><br><span class="line"><span class="comment">//业务相关异常</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LiveMallException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LiveMallException</span><span class="params">(Integer code, String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LiveMallException</span><span class="params">(String message, Integer code, String message1)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.message = message1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LiveMallException</span><span class="params">(String message, Throwable cause, Integer code, String message1)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message, cause);</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.message = message1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LiveMallException</span><span class="params">(Throwable cause, Integer code, String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(cause);</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LiveMallException</span><span class="params">(String message, Throwable cause, <span class="keyword">boolean</span> enableSuppression, <span class="keyword">boolean</span> writableStackTrace, Integer code, String message1)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message, cause, enableSuppression, writableStackTrace);</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.message = message1;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LiveMallException</span><span class="params">(LiveMallExceptionEnum exceptionEnum)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(exceptionEnum.getCode(),exceptionEnum.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre>



<ul>
<li>在异常处理中，使用到了<strong>自定义枚举</strong>。这个主要是在controller层写具体控制器的时候，作为统一返回对象的方法参数使用。</li>
</ul>
<pre class="highlight"><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">ApiRestResponse&lt;Object&gt; <span class="title">error</span><span class="params">(LiveMallExceptionEnum ex)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiRestResponse&lt;&gt;(ex.getCode(),ex.getMsg());</span><br><span class="line">    &#125;</span><br></pre>



<pre class="highlight"><span class="line"><span class="keyword">package</span> com.shu.mall.exception;</span><br><span class="line"><span class="comment">//异常枚举</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">LiveMallExceptionEnum</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    NEED_UESR_NAME(<span class="number">10001</span>,<span class="string">&quot;用户名不能为空&quot;</span>),</span><br><span class="line">    NEED_PASSWORD(<span class="number">10002</span>,<span class="string">&quot;密码不能为空&quot;</span>),</span><br><span class="line">    PASSWORD_TOO_SHORT(<span class="number">10003</span>,<span class="string">&quot;密码太短&quot;</span>),</span><br><span class="line">    NAME_EXISTED(<span class="number">10004</span>,<span class="string">&quot;不允许重名&quot;</span>),</span><br><span class="line">    INSERT_FAILED(<span class="number">10005</span>,<span class="string">&quot;插入失败，请重试&quot;</span>),</span><br><span class="line">    WRONG_PASSWORD(<span class="number">10006</span>,<span class="string">&quot;密码错误&quot;</span>),</span><br><span class="line">    NEED_LOGIN(<span class="number">10007</span>,<span class="string">&quot;用户未登录&quot;</span>),</span><br><span class="line">    UPDATE_FAILED(<span class="number">10008</span>,<span class="string">&quot;更新失败&quot;</span>),</span><br><span class="line">    NEED_ADMIN(<span class="number">10009</span>,<span class="string">&quot;无管理员权限&quot;</span>),</span><br><span class="line">    PARA_NOT_NULL(<span class="number">10010</span>,<span class="string">&quot;名字不能为空&quot;</span>),</span><br><span class="line">    CREATE_FAILED(<span class="number">10011</span>,<span class="string">&quot;创建失败&quot;</span>),</span><br><span class="line">    REQUEST_PARAM_ERROR(<span class="number">10012</span>,<span class="string">&quot;请求参数失败&quot;</span>),</span><br><span class="line">    DELETE_FAILED(<span class="number">10013</span>,<span class="string">&quot;删除失败&quot;</span>),</span><br><span class="line">    MKDIR_FAILED(<span class="number">10014</span>,<span class="string">&quot;文件夹创建失败&quot;</span>),</span><br><span class="line">    UPLOAD_FAILED(<span class="number">10015</span>,<span class="string">&quot;上传失败&quot;</span>),</span><br><span class="line">    NOT_SALE(<span class="number">10016</span>, <span class="string">&quot;商品状态不可售&quot;</span>),</span><br><span class="line">    NOT_ENOUGH(<span class="number">10017</span>, <span class="string">&quot;商品库存不足&quot;</span>),</span><br><span class="line">    CART_EMPTY(<span class="number">10018</span>, <span class="string">&quot;购物车已勾选的商品为空&quot;</span>),</span><br><span class="line">    NO_ENUM(<span class="number">10019</span>, <span class="string">&quot;未找到对应的枚举&quot;</span>),</span><br><span class="line">    NO_ORDER(<span class="number">10020</span>, <span class="string">&quot;订单不存在&quot;</span>),</span><br><span class="line">    NOT_YOUR_ORDER(<span class="number">10021</span>, <span class="string">&quot;订单不属于你&quot;</span>),</span><br><span class="line">    WRONG_ORDER_STATUS(<span class="number">10022</span>, <span class="string">&quot;订单状态不符&quot;</span>),</span><br><span class="line">    SYSTEM_ERROR(<span class="number">20000</span>,<span class="string">&quot;系统错误&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Integer code;</span><br><span class="line">    String msg;</span><br><span class="line">    </span><br><span class="line">    LiveMallExceptionEnum(Integer code, String msg) &#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCode</span><span class="params">(Integer code)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMsg</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;LiveMallExceptionEnum&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;code=&quot;</span> + code +</span><br><span class="line">                <span class="string">&quot;, msg=&#x27;&quot;</span> + msg + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre>



<h4 id="2、参数校验"><a href="#2、参数校验" class="headerlink" title="2、参数校验"></a>2、参数校验</h4><ul>
<li>如果不用参数校验，原始的就是if语句，那就太傻了…..</li>
<li>我们不傻，我们在请求类中用valid参数校验</li>
</ul>
<pre class="highlight"><span class="line"><span class="keyword">package</span> com.shu.mall.model.request;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Max;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotNull;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Size;</span><br><span class="line"></span><br><span class="line"><span class="comment">//添加目录的请求类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AddCategoryReq</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Size(min =2,max=5)</span></span><br><span class="line">    <span class="meta">@NotNull(message = &quot;name:不能为null&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Max(3)</span></span><br><span class="line">    <span class="meta">@NotNull(message = &quot;type:不能为null&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer type;</span><br><span class="line">    <span class="meta">@NotNull(message = &quot;parentId:不能为null&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer parentId;</span><br><span class="line">    <span class="meta">@NotNull(message = &quot;orderNum:不能为null&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer orderNum;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setType</span><span class="params">(Integer type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getParentId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> parentId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setParentId</span><span class="params">(Integer parentId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.parentId = parentId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getOrderNum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> orderNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrderNum</span><span class="params">(Integer orderNum)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.orderNum = orderNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;AddCategoryReq&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, type=&quot;</span> + type +</span><br><span class="line">                <span class="string">&quot;, parentId=&quot;</span> + parentId +</span><br><span class="line">                <span class="string">&quot;, orderNum=&quot;</span> + orderNum +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre>



<h4 id="3、统一响应"><a href="#3、统一响应" class="headerlink" title="3、统一响应"></a>3、统一响应</h4><pre class="highlight"><span class="line"><span class="keyword">package</span> com.shu.mall.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.shu.mall.exception.LiveMallExceptionEnum;</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回通用接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApiRestResponse</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//状态码</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">    <span class="comment">//信息</span></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="comment">//泛型，数据类型不固定，表示数据</span></span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> OK_CODE = <span class="number">10000</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String OK_MSG = <span class="string">&quot;SUCCESS&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getStatus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStatus</span><span class="params">(Integer status)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMsg</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(T data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getOkCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> OK_CODE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getOkMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> OK_MSG;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ApiRestResponse</span><span class="params">(Integer status, String msg, T data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ApiRestResponse</span><span class="params">(Integer status, String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ApiRestResponse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(OK_CODE,OK_MSG);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">ApiRestResponse&lt;T&gt; <span class="title">success</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiRestResponse&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">ApiRestResponse&lt;Object&gt; <span class="title">success</span><span class="params">(T result)</span></span>&#123;</span><br><span class="line">        ApiRestResponse&lt;Object&gt; response = <span class="keyword">new</span> ApiRestResponse&lt;&gt;();</span><br><span class="line">        response.setData(result);</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">ApiRestResponse&lt;Object&gt; <span class="title">error</span><span class="params">(Integer code ,String msg)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiRestResponse&lt;&gt;(code,msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">ApiRestResponse&lt;Object&gt; <span class="title">error</span><span class="params">(LiveMallExceptionEnum ex)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiRestResponse&lt;&gt;(ex.getCode(),ex.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre>

<h4 id="4、Redis缓存的使用"><a href="#4、Redis缓存的使用" class="headerlink" title="4、Redis缓存的使用"></a>4、Redis缓存的使用</h4><ul>
<li>首先，在pom.xml文件中添加依赖</li>
</ul>
<pre class="highlight"><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre>

<ul>
<li>然后，在启动类中使用@EnableCaching注解启动缓存</li>
</ul>
<pre class="highlight"><span class="line"><span class="keyword">package</span> com.shu.mall;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 严树成</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(basePackages = &quot;com.shu.mall.model.dao&quot;)</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MallApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(MallApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre>

<ul>
<li>然后，在application.properties中配置Redis的主机号和端口号（注意，记住端口号6379！）</li>
</ul>
<pre class="highlight"><span class="line"><span class="meta">spring.redis.host</span>=<span class="string">localhost</span></span><br><span class="line"><span class="meta">spring.redis.port</span>=<span class="string">6379</span></span><br></pre>

<ul>
<li>然后，配置CacheManager,设置缓存持续时间为30s</li>
</ul>
<pre class="highlight"><span class="line"><span class="keyword">package</span> com.shu.mall.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.cache.RedisCacheConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.cache.RedisCacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.cache.RedisCacheWriter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CachingConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisCacheManager <span class="title">redisCacheManager</span><span class="params">(RedisConnectionFactory connectionFactory)</span></span>&#123;</span><br><span class="line">        RedisCacheWriter redisCacheWriter = RedisCacheWriter</span><br><span class="line">                .lockingRedisCacheWriter(connectionFactory);</span><br><span class="line">        RedisCacheConfiguration cacheConfiguration = RedisCacheConfiguration.defaultCacheConfig();</span><br><span class="line">        cacheConfiguration = cacheConfiguration.entryTtl(Duration.ofSeconds(<span class="number">30</span>));</span><br><span class="line"></span><br><span class="line">        RedisCacheManager redisCacheManager = <span class="keyword">new</span> RedisCacheManager(redisCacheWriter,</span><br><span class="line">                cacheConfiguration);</span><br><span class="line">        <span class="keyword">return</span> redisCacheManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre>

<ul>
<li>使用Redis，在service层的实现类中，在面向用户的<strong>商品列表</strong>查询的接口实现中添加**@Cacheable注解**</li>
</ul>
<pre class="highlight"><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;listCategoryForCustomer&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;CategoryVo&gt; <span class="title">listCategoryForCustomer</span><span class="params">(Integer parentId)</span></span>&#123;</span><br><span class="line">        ArrayList&lt;CategoryVo&gt; categoryVoList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        recursivelyFindCategories(categoryVoList,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> categoryVoList;</span><br><span class="line">    &#125;</span><br></pre>

<h4 id="5、SpringBoot整合MyBatis配置"><a href="#5、SpringBoot整合MyBatis配置" class="headerlink" title="5、SpringBoot整合MyBatis配置"></a>5、SpringBoot整合MyBatis配置</h4><ul>
<li>首先，pom.xml的依赖</li>
</ul>
<pre class="highlight"><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre>

<ul>
<li>application.properties配置（<strong>数据库驱动、用户名和密码、url、端口号、mapper文件所在路径</strong>）</li>
</ul>
<pre class="highlight"><span class="line"><span class="meta">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string">ysc223</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/imooc_mall?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=GMT</span></span><br><span class="line"><span class="meta">server.port</span>=<span class="string">8083</span></span><br><span class="line"></span><br><span class="line"><span class="meta">mybatis.mapper-locations</span>=<span class="string">classpath:mappers/*.xml</span></span><br></pre>

<ul>
<li>mapper映射（dao层Mapper接口–&gt;Mapper.xml文件）</li>
</ul>
<pre class="highlight"><span class="line"><span class="keyword">package</span> com.shu.mall.model.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.shu.mall.model.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 严树成</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span> 用户接口。包含增删改查用户信息的抽象方法。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@describe</span> 根据主键删除用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id ，Integer类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteByPrimaryKey</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@describe</span> 插入用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> record ，User类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(User record)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@describe</span> 选择性的插入用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> record</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insertSelective</span><span class="params">(User record)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@describe</span> 根据主键查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 用户 User类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">User <span class="title">selectByPrimaryKey</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@describe</span> 根据主键选择的更新</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> record</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateByPrimaryKeySelective</span><span class="params">(User record)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@describe</span> 通过主键更新</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> record</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateByPrimaryKey</span><span class="params">(User record)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">User <span class="title">selectByName</span><span class="params">(String userName)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">User <span class="title">selectLogin</span><span class="params">(<span class="meta">@Param(&quot;userName&quot;)</span> String userName, <span class="meta">@Param(&quot;password&quot;)</span> String password)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre>

<pre class="highlight"><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.shu.mall.model.dao.UserMapper&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;BaseResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.shu.mall.model.pojo.User&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;password&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;personalized_signature&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;personalizedSignature&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;role&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;role&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;create_time&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TIMESTAMP&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createTime&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;update_time&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TIMESTAMP&quot;</span> <span class="attr">property</span>=<span class="string">&quot;updateTime&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;Base_Column_List&quot;</span>&gt;</span></span><br><span class="line">    id, username, `password`, personalized_signature, `role`, create_time, update_time</span><br><span class="line">  <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByPrimaryKey&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.Integer&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">    select </span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;Base_Column_List&quot;</span> /&gt;</span></span><br><span class="line">    from imooc_mall_user</span><br><span class="line">    where id = #&#123;id,jdbcType=INTEGER&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByPrimaryKey&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">    delete from imooc_mall_user</span><br><span class="line">    where id = #&#123;id,jdbcType=INTEGER&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.shu.mall.model.pojo.User&quot;</span>&gt;</span></span><br><span class="line">    insert into imooc_mall_user (id, username, `password`, </span><br><span class="line">      personalized_signature, `role`, create_time, </span><br><span class="line">      update_time)</span><br><span class="line">    values (#&#123;id,jdbcType=INTEGER&#125;, #&#123;username,jdbcType=VARCHAR&#125;, #&#123;password,jdbcType=VARCHAR&#125;, </span><br><span class="line">      #&#123;personalizedSignature,jdbcType=VARCHAR&#125;, #&#123;role,jdbcType=INTEGER&#125;, #&#123;createTime,jdbcType=TIMESTAMP&#125;, </span><br><span class="line">      #&#123;updateTime,jdbcType=TIMESTAMP&#125;)</span><br><span class="line">  <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertSelective&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.shu.mall.model.pojo.User&quot;</span>&gt;</span></span><br><span class="line">    insert into imooc_mall_user</span><br><span class="line">    <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;(&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;)&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id != null&quot;</span>&gt;</span></span><br><span class="line">        id,</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null&quot;</span>&gt;</span></span><br><span class="line">        username,</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;password != null&quot;</span>&gt;</span></span><br><span class="line">        `password`,</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;personalizedSignature != null&quot;</span>&gt;</span></span><br><span class="line">        personalized_signature,</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;role != null&quot;</span>&gt;</span></span><br><span class="line">        `role`,</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;createTime != null&quot;</span>&gt;</span></span><br><span class="line">        create_time,</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateTime != null&quot;</span>&gt;</span></span><br><span class="line">        update_time,</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;values (&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;)&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id != null&quot;</span>&gt;</span></span><br><span class="line">        #&#123;id,jdbcType=INTEGER&#125;,</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null&quot;</span>&gt;</span></span><br><span class="line">        #&#123;username,jdbcType=VARCHAR&#125;,</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;password != null&quot;</span>&gt;</span></span><br><span class="line">        #&#123;password,jdbcType=VARCHAR&#125;,</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;personalizedSignature != null&quot;</span>&gt;</span></span><br><span class="line">        #&#123;personalizedSignature,jdbcType=VARCHAR&#125;,</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;role != null&quot;</span>&gt;</span></span><br><span class="line">        #&#123;role,jdbcType=INTEGER&#125;,</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;createTime != null&quot;</span>&gt;</span></span><br><span class="line">        #&#123;createTime,jdbcType=TIMESTAMP&#125;,</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateTime != null&quot;</span>&gt;</span></span><br><span class="line">        #&#123;updateTime,jdbcType=TIMESTAMP&#125;,</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateByPrimaryKeySelective&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.shu.mall.model.pojo.User&quot;</span>&gt;</span></span><br><span class="line">    update imooc_mall_user</span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null&quot;</span>&gt;</span></span><br><span class="line">        username = #&#123;username,jdbcType=VARCHAR&#125;,</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;password != null&quot;</span>&gt;</span></span><br><span class="line">        `password` = #&#123;password,jdbcType=VARCHAR&#125;,</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;personalizedSignature != null&quot;</span>&gt;</span></span><br><span class="line">        personalized_signature = #&#123;personalizedSignature,jdbcType=VARCHAR&#125;,</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;role != null&quot;</span>&gt;</span></span><br><span class="line">        `role` = #&#123;role,jdbcType=INTEGER&#125;,</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;createTime != null&quot;</span>&gt;</span></span><br><span class="line">        create_time = #&#123;createTime,jdbcType=TIMESTAMP&#125;,</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateTime != null&quot;</span>&gt;</span></span><br><span class="line">        update_time = #&#123;updateTime,jdbcType=TIMESTAMP&#125;,</span><br><span class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    where id = #&#123;id,jdbcType=INTEGER&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateByPrimaryKey&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.shu.mall.model.pojo.User&quot;</span>&gt;</span></span><br><span class="line">    update imooc_mall_user</span><br><span class="line">    set username = #&#123;username,jdbcType=VARCHAR&#125;,</span><br><span class="line">      `password` = #&#123;password,jdbcType=VARCHAR&#125;,</span><br><span class="line">      personalized_signature = #&#123;personalizedSignature,jdbcType=VARCHAR&#125;,</span><br><span class="line">      `role` = #&#123;role,jdbcType=INTEGER&#125;,</span><br><span class="line">      create_time = #&#123;createTime,jdbcType=TIMESTAMP&#125;,</span><br><span class="line">      update_time = #&#123;updateTime,jdbcType=TIMESTAMP&#125;</span><br><span class="line">    where id = #&#123;id,jdbcType=INTEGER&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByName&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.String&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">resultMap</span>=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">            select</span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;Base_Column_List&quot;</span>/&gt;</span></span><br><span class="line">              from imooc_mall_user</span><br><span class="line">              where username =#&#123;userName,jdbcType=VARCHAR&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectLogin&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">resultMap</span>=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">    select</span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;Base_Column_List&quot;</span>/&gt;</span></span><br><span class="line">    from imooc_mall_user</span><br><span class="line">    where username =#&#123;userName,jdbcType=VARCHAR&#125;</span><br><span class="line">    and password=#&#123;password&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre>

<h4 id="6、使用AOP统一处理Web请求日志（面向切面编程和日志-在项目中也属于过滤器的一部分）"><a href="#6、使用AOP统一处理Web请求日志（面向切面编程和日志-在项目中也属于过滤器的一部分）" class="headerlink" title="6、使用AOP统一处理Web请求日志（面向切面编程和日志,在项目中也属于过滤器的一部分）"></a>6、使用AOP统一处理Web请求日志（面向切面编程和日志,在项目中也属于过滤器的一部分）</h4><ul>
<li>首先，在pom.xml导入web模块</li>
</ul>
<pre class="highlight"><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre>

<ul>
<li>引入AOP依赖和log4j2日志依赖</li>
</ul>
<pre class="highlight"><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre>

<ul>
<li><p>实现Web层面的日志切面</p>
<p>使用<code>@Aspect</code>注解将一个java类定义为切面类</p>
<p>使用<code>@Pointcut</code>定义一个切入点，可以是一个规则表达式，比如下例中某个package下的所有函数，也可以是一个注解等。</p>
<p>使用<code>@Before</code>在切入点开始处切入内容</p>
<p>使用<code>@After</code>在切入点结尾处切入内容</p>
<p>使用<code>@AfterReturning</code>在切入点return内容之后切入内容（可以用来对处理返回值做一些加工处理）</p>
</li>
</ul>
<pre class="highlight"><span class="line"><span class="keyword">package</span> com.shu.mall.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterReturning;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebLogAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger log = LoggerFactory.getLogger(WebLogAspect.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(public * com.shu.mall.controller.*.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">webLog</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;webLog()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doBefore</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//收到请求，记录请求记录</span></span><br><span class="line">        ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();</span><br><span class="line">        HttpServletRequest request = attributes.getRequest();</span><br><span class="line">        log.info(<span class="string">&quot;URL:&quot;</span> + request.getRequestURL().toString());</span><br><span class="line">        log.info(<span class="string">&quot;HTTP_METHOD:&quot;</span> + request.getMethod());</span><br><span class="line">        log.info(<span class="string">&quot;IP:&quot;</span> + request.getRemoteAddr());</span><br><span class="line">        log.info(<span class="string">&quot;CLASS_METHOD:&quot;</span> + joinPoint.getSignature().getDeclaringTypeName() + <span class="string">&quot;.&quot;</span> + joinPoint.getSignature().getName());</span><br><span class="line">        log.info(<span class="string">&quot;ARGS:&quot;</span> + Arrays.toString(joinPoint.getArgs()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning(returning = &quot;res&quot;, pointcut = &quot;webLog()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterReturning</span><span class="params">(Object res)</span> <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">        <span class="comment">//处理完请求，返回内容</span></span><br><span class="line">        log.info(<span class="string">&quot;RESPONSE:&quot;</span> + <span class="keyword">new</span> ObjectMapper().writeValueAsString(res));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre>

<h4 id="7、用户控制器（Session、登录状态判断、权限管理、过滤器）"><a href="#7、用户控制器（Session、登录状态判断、权限管理、过滤器）" class="headerlink" title="7、用户控制器（Session、登录状态判断、权限管理、过滤器）"></a>7、用户控制器（Session、登录状态判断、权限管理、过滤器）</h4><ul>
<li>面向用户的如下，主要判断是否处于登录状态</li>
</ul>
<pre class="highlight"><span class="line"><span class="keyword">package</span> com.shu.mall.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.shu.mall.common.Constant;</span><br><span class="line"><span class="keyword">import</span> com.shu.mall.model.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.shu.mall.service.UserService;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponseWrapper;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 描述：     用户过滤器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> User currentUser;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse,</span></span></span><br><span class="line"><span class="function"><span class="params">            FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        HttpServletRequest request = (HttpServletRequest) servletRequest;</span><br><span class="line">        HttpSession session = request.getSession();</span><br><span class="line">        currentUser = (User) session.getAttribute(Constant.LIVE_MALL_USER);</span><br><span class="line">        <span class="keyword">if</span> (currentUser == <span class="keyword">null</span>) &#123;</span><br><span class="line">            PrintWriter out = <span class="keyword">new</span> HttpServletResponseWrapper(</span><br><span class="line">                    (HttpServletResponse) servletResponse).getWriter();</span><br><span class="line">            out.write(<span class="string">&quot;&#123;\n&quot;</span></span><br><span class="line">                    + <span class="string">&quot;    \&quot;status\&quot;: 10007,\n&quot;</span></span><br><span class="line">                    + <span class="string">&quot;    \&quot;msg\&quot;: \&quot;NEED_LOGIN\&quot;,\n&quot;</span></span><br><span class="line">                    + <span class="string">&quot;    \&quot;data\&quot;: null\n&quot;</span></span><br><span class="line">                    + <span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">            out.flush();</span><br><span class="line">            out.close();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre>

<ul>
<li></li>
</ul>
<p>面向管理员的如下，主要判断是否处于登录状态以及是否是管理员权限</p>
<pre class="highlight"><span class="line"><span class="keyword">package</span> com.shu.mall.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.shu.mall.common.Constant;</span><br><span class="line"><span class="keyword">import</span> com.shu.mall.model.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.shu.mall.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponseWrapper;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="comment">//统一校验处理</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService userService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        HttpServletRequest request1 = (HttpServletRequest) request;</span><br><span class="line">        HttpSession session = request1.getSession();</span><br><span class="line">        User currentUser = (User) session.getAttribute(Constant.LIVE_MALL_USER);</span><br><span class="line">        <span class="keyword">if</span> (currentUser == <span class="keyword">null</span>) &#123;</span><br><span class="line">            PrintWriter out = <span class="keyword">new</span> HttpServletResponseWrapper((HttpServletResponse) response).getWriter();</span><br><span class="line">            out.write(<span class="string">&quot;&#123;\n&quot;</span></span><br><span class="line">                    + <span class="string">&quot;    \&quot;status\&quot;: 10007,\n&quot;</span></span><br><span class="line">                    + <span class="string">&quot;    \&quot;msg\&quot;: \&quot;NEED_LOGIN\&quot;,\n&quot;</span></span><br><span class="line">                    + <span class="string">&quot;    \&quot;data\&quot;: null\n&quot;</span></span><br><span class="line">                    + <span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">            out.flush();</span><br><span class="line">            out.close();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//校验当前登录用户是否管理员</span></span><br><span class="line">        <span class="keyword">if</span> (currentUser.getRole() == <span class="number">2</span>) &#123;</span><br><span class="line">            chain.doFilter(request,response);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            PrintWriter out = <span class="keyword">new</span> HttpServletResponseWrapper((HttpServletResponse) response).getWriter();</span><br><span class="line">            out.write(<span class="string">&quot;&#123;\n&quot;</span></span><br><span class="line">                    + <span class="string">&quot;    \&quot;status\&quot;: 10009,\n&quot;</span></span><br><span class="line">                    + <span class="string">&quot;    \&quot;msg\&quot;: \&quot;NEED_ADMIN\&quot;,\n&quot;</span></span><br><span class="line">                    + <span class="string">&quot;    \&quot;data\&quot;: null\n&quot;</span></span><br><span class="line">                    + <span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">            out.flush();</span><br><span class="line">            out.close();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre>

<h4 id="8、PageInfo分页处理"><a href="#8、PageInfo分页处理" class="headerlink" title="8、PageInfo分页处理"></a>8、PageInfo分页处理</h4><ol>
<li>首先，导入pagehelper依赖</li>
</ol>
<pre class="highlight"><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre>

<pre><code>2. 然后初始化分页参数、查询结果、对查询结果进行分页
</code></pre>
<pre class="highlight"><span class="line"><span class="keyword">package</span> com.shu.mall.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.PageHelper;</span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.PageInfo;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PageInfo <span class="title">listforAdmin</span><span class="params">(Integer pageNum, Integer pageSize)</span></span>&#123;</span><br><span class="line">        PageHelper.startPage(pageNum,pageSize);</span><br><span class="line">        List&lt;Product&gt; products = productMapper.selectListForAdmin();</span><br><span class="line">        PageInfo pageInfo = <span class="keyword">new</span> PageInfo(products);</span><br><span class="line">        <span class="keyword">return</span> pageInfo;</span><br></pre>

<ol start="3">
<li>面向用户的商品列表返回，涉及搜索处理、目录处理、排序处理。Query对象中默认设置pageNum=1，pageSize=10</li>
</ol>
<pre class="highlight"><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PageInfo <span class="title">list</span><span class="params">(ProductListReq productListReq)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//构建Query对象</span></span><br><span class="line">        ProductListQuery productListQuery = <span class="keyword">new</span> ProductListQuery();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//搜索处理</span></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(productListReq.getKeyword())) &#123;</span><br><span class="line">            String keyword = <span class="keyword">new</span> StringBuilder().append(<span class="string">&quot;%&quot;</span>).append(productListReq.getKeyword())</span><br><span class="line">                    .append(<span class="string">&quot;%&quot;</span>).toString();</span><br><span class="line">            productListQuery.setKeyword(keyword);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//目录处理：如果查某个目录下的商品，不仅是需要查出该目录下的，还要把所有子目录的所有商品都查出来，所以要拿到一个目录id的List</span></span><br><span class="line">        <span class="keyword">if</span> (productListReq.getCategoryId() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            List&lt;CategoryVo&gt; categoryVoList = categoryService</span><br><span class="line">                    .listCategoryForCustomer(productListReq.getCategoryId());</span><br><span class="line">            ArrayList&lt;Integer&gt; categoryIds = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            categoryIds.add(productListReq.getCategoryId());</span><br><span class="line">            getCategoryIds(categoryVoList, categoryIds);</span><br><span class="line">            productListQuery.setCategoryIds(categoryIds);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//排序处理</span></span><br><span class="line">        String orderBy = productListReq.getOrderBy();</span><br><span class="line">        <span class="keyword">if</span> (Constant.ProductListOrderBy.PRICE_ASC_DESC.contains(orderBy)) &#123;</span><br><span class="line">            PageHelper.startPage(productListReq.getPageNum(), productListReq.getPageSize(), orderBy);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            PageHelper.startPage(productListReq.getPageNum(), productListReq.getPageSize());</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Product&gt; productList = productMapper.selectList(productListQuery);</span><br><span class="line">        PageInfo pageInfo = <span class="keyword">new</span> PageInfo(productList);</span><br><span class="line">        <span class="keyword">return</span> pageInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getCategoryIds</span><span class="params">(List&lt;CategoryVo&gt; categoryVoList, ArrayList&lt;Integer&gt; categoryIds)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; categoryVoList.size(); i++) &#123;</span><br><span class="line">            CategoryVo categoryVo = categoryVoList.get(i);</span><br><span class="line">            <span class="keyword">if</span> (categoryVo != <span class="keyword">null</span>) &#123;</span><br><span class="line">                categoryIds.add(categoryVo.getId());</span><br><span class="line">                getCategoryIds(categoryVo.getChildCategory(), categoryIds);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre>

<h4 id="9、事务管理订单模块"><a href="#9、事务管理订单模块" class="headerlink" title="9、事务管理订单模块"></a>9、事务管理订单模块</h4><ul>
<li>触发回滚的异常设置为Exception.class，MySQL的默认事务隔离级别是可重复读</li>
</ul>
<pre class="highlight"><span class="line"><span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">create</span><span class="params">(CreateOrderReq createOrderReq)</span></span>&#123;</span><br><span class="line">    <span class="comment">//拿到用户ID</span></span><br><span class="line">    Integer userId = UserFilter.currentUser.getId();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从购物车查找已经勾选的商品</span></span><br><span class="line">    List&lt;CartVO&gt; cartVOList = cartService.list(userId);</span><br><span class="line">    ArrayList&lt;CartVO&gt; cartVOTemp = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; cartVOList.size(); i++) &#123;</span><br><span class="line">        CartVO cartVO = cartVOList.get(i);</span><br><span class="line">        <span class="keyword">if</span> (cartVO.getSelected().equals(Constant.Cart.CHECKED)) &#123;</span><br><span class="line">            cartVOTemp.add(cartVO);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cartVOList = cartVOTemp;</span><br><span class="line">    <span class="comment">//如果购物车已勾选的为空，报错</span></span><br><span class="line">    <span class="keyword">if</span> (CollectionUtils.isEmpty(cartVOList)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> LiveMallException(LiveMallExceptionEnum.CART_EMPTY);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//判断商品是否存在、上下架状态、库存</span></span><br><span class="line">    validSaleStatusAndStock(cartVOList);</span><br><span class="line">    <span class="comment">//把购物车对象转化成订单item对象</span></span><br><span class="line">    List&lt;OrderItem&gt; orderItemList = cartVOListToOrderItemList(cartVOList);</span><br><span class="line">    <span class="comment">//扣库存</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; orderItemList.size(); i++) &#123;</span><br><span class="line">        Product product = productMapper.selectByPrimaryKey(orderItemList.get(i).getProductId());</span><br><span class="line">        Integer stock = product.getStock();</span><br><span class="line">        stock=stock-orderItemList.get(i).getQuantity();</span><br><span class="line">        <span class="keyword">if</span> (stock&lt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> LiveMallException(LiveMallExceptionEnum.NOT_ENOUGH);</span><br><span class="line">        &#125;</span><br><span class="line">        product.setStock(stock);</span><br><span class="line">        productMapper.updateByPrimaryKeySelective(product);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//把购物车中的已勾选商品删除</span></span><br><span class="line">    cleanCart(cartVOList);</span><br><span class="line">    <span class="comment">//生成订单</span></span><br><span class="line">    Order order = <span class="keyword">new</span> Order();</span><br><span class="line">    <span class="comment">//生成订单号，有独立的规则</span></span><br><span class="line">    String orderNo = OrderCodeFactory.getOrderCode(Long.valueOf(userId));</span><br><span class="line"></span><br><span class="line">    order.setOrderNo(orderNo);</span><br><span class="line">    order.setUserId(userId);</span><br><span class="line">    order.setTotalPrice(totalPrice(orderItemList));</span><br><span class="line">    order.setReceiverName(createOrderReq.getReceiverName());</span><br><span class="line">    order.setReceiverMobile(createOrderReq.getReceiverMobile());</span><br><span class="line">    order.setReceiverAddress(createOrderReq.getReceiverAddress());</span><br><span class="line">    order.setOrderStatus(Constant.OrderStatusEnum.NOT_PAID.getCode());</span><br><span class="line">    order.setPostage(<span class="number">0</span>);</span><br><span class="line">    order.setPaymentType(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//插入到order表</span></span><br><span class="line">    orderMapper.insertSelective(order);</span><br><span class="line">    <span class="comment">//循环保存每个商品到order_item表</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; orderItemList.size(); i++) &#123;</span><br><span class="line">        OrderItem orderItem = orderItemList.get(i);</span><br><span class="line">        orderItem.setOrderNo(order.getOrderNo());</span><br><span class="line">        orderItemMapper.insertSelective(orderItem);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//把结果返回</span></span><br><span class="line">    <span class="keyword">return</span> orderNo;</span><br><span class="line">&#125;</span><br></pre>

<p>[TOC]</p>

  </div>
  <div>
  
  </div>
</article>
<div class="nav">
  
  <div class="nav-item-prev">
    <a href="/2021/03/23/面经问题整理/" class="nav-link">
      <i class="iconfont icon-left nav-prev-icon"></i>
      <div>
        <div class="nav-label">上一篇</div>
        
        <div class="nav-title">面经问题整理 </div>
        
      </div>
    </a>
  </div>
  
  
  <div class="nav-item-next">
    <a href="/2021/03/22/鼓楼-歌词/" class="nav-link">
      <div>
        <div class="nav-label">下一篇</div>
        
        <div class="nav-title">鼓楼|歌词 </div>
        
      </div>
      <i class="iconfont icon-right nav-next-icon"></i>
    </a>
  </div>
  
</div>

<div class="card card-content toc-card" id="mobiletoc">
  <div class="toc-header"><i class="iconfont icon-menu" style="padding-right: 2px;"></i>目录</div>
<ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E7%BB%9F%E4%B8%80%E5%BC%82%E5%B8%B8"><span class="toc-text">1、统一异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C"><span class="toc-text">2、参数校验</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E7%BB%9F%E4%B8%80%E5%93%8D%E5%BA%94"><span class="toc-text">3、统一响应</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81Redis%E7%BC%93%E5%AD%98%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">4、Redis缓存的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81SpringBoot%E6%95%B4%E5%90%88MyBatis%E9%85%8D%E7%BD%AE"><span class="toc-text">5、SpringBoot整合MyBatis配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%E3%80%81%E4%BD%BF%E7%94%A8AOP%E7%BB%9F%E4%B8%80%E5%A4%84%E7%90%86Web%E8%AF%B7%E6%B1%82%E6%97%A5%E5%BF%97%EF%BC%88%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B%E5%92%8C%E6%97%A5%E5%BF%97-%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%B9%9F%E5%B1%9E%E4%BA%8E%E8%BF%87%E6%BB%A4%E5%99%A8%E7%9A%84%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%89"><span class="toc-text">6、使用AOP统一处理Web请求日志（面向切面编程和日志,在项目中也属于过滤器的一部分）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7%E3%80%81%E7%94%A8%E6%88%B7%E6%8E%A7%E5%88%B6%E5%99%A8%EF%BC%88Session%E3%80%81%E7%99%BB%E5%BD%95%E7%8A%B6%E6%80%81%E5%88%A4%E6%96%AD%E3%80%81%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E3%80%81%E8%BF%87%E6%BB%A4%E5%99%A8%EF%BC%89"><span class="toc-text">7、用户控制器（Session、登录状态判断、权限管理、过滤器）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8%E3%80%81PageInfo%E5%88%86%E9%A1%B5%E5%A4%84%E7%90%86"><span class="toc-text">8、PageInfo分页处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9%E3%80%81%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E8%AE%A2%E5%8D%95%E6%A8%A1%E5%9D%97"><span class="toc-text">9、事务管理订单模块</span></a></li></ol>
</div></main>
          <aside class="left-column">
            
            <div class="card card-author">
              
<img src="/img/aze.png" class="author-img">

<p class="author-name">燕树城</p>
<p class="author-description">花有重开日，人无再少年</p>
<div class="author-message">
  <a class="author-posts-count" href="/archives">
    <span>16</span>
    <span>文章</span>
  </a>
  <a class="author-categories-count" href="/categories">
    <span>0</span>
    <span>分类</span>
  </a>
  <a class="author-tags-count" href="/tags">
    <span>0</span>
    <span>标签</span>
  </a>
</div>

            </div>
            
            <div class="sticky-tablet">
  
  
  <article class="display-when-two-columns spacer">
    <div class="card card-content toc-card">
      <div class="toc-header"><i class="iconfont icon-menu" style="padding-right: 2px;"></i>目录</div>
<ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E7%BB%9F%E4%B8%80%E5%BC%82%E5%B8%B8"><span class="toc-text">1、统一异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C"><span class="toc-text">2、参数校验</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E7%BB%9F%E4%B8%80%E5%93%8D%E5%BA%94"><span class="toc-text">3、统一响应</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81Redis%E7%BC%93%E5%AD%98%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">4、Redis缓存的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81SpringBoot%E6%95%B4%E5%90%88MyBatis%E9%85%8D%E7%BD%AE"><span class="toc-text">5、SpringBoot整合MyBatis配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%E3%80%81%E4%BD%BF%E7%94%A8AOP%E7%BB%9F%E4%B8%80%E5%A4%84%E7%90%86Web%E8%AF%B7%E6%B1%82%E6%97%A5%E5%BF%97%EF%BC%88%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B%E5%92%8C%E6%97%A5%E5%BF%97-%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%B9%9F%E5%B1%9E%E4%BA%8E%E8%BF%87%E6%BB%A4%E5%99%A8%E7%9A%84%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%89"><span class="toc-text">6、使用AOP统一处理Web请求日志（面向切面编程和日志,在项目中也属于过滤器的一部分）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7%E3%80%81%E7%94%A8%E6%88%B7%E6%8E%A7%E5%88%B6%E5%99%A8%EF%BC%88Session%E3%80%81%E7%99%BB%E5%BD%95%E7%8A%B6%E6%80%81%E5%88%A4%E6%96%AD%E3%80%81%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E3%80%81%E8%BF%87%E6%BB%A4%E5%99%A8%EF%BC%89"><span class="toc-text">7、用户控制器（Session、登录状态判断、权限管理、过滤器）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8%E3%80%81PageInfo%E5%88%86%E9%A1%B5%E5%A4%84%E7%90%86"><span class="toc-text">8、PageInfo分页处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9%E3%80%81%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E8%AE%A2%E5%8D%95%E6%A8%A1%E5%9D%97"><span class="toc-text">9、事务管理订单模块</span></a></li></ol>
    </div>
  </article>
  
  
  <article class="card card-content categories-widget">
    <div class="categories-card">
  <div class="categories-header"><i class="iconfont icon-fenlei" style="padding-right: 2px;"></i>分类</div>
  <div class="categories-list">
    
  </div>
</div>
  </article>
  
  <article class="card card-content tags-widget">
    <div class="tags-card">
  <div class="tags-header"><i class="iconfont icon-biaoqian" style="padding-right: 2px;"></i>热门标签</div>
  <div class="tags-list">
    
  </div>
</div>
  </article>
  
  
  <nav class="header-music">
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=100% height=86 src="//music.163.com/outchain/player?type=2&id=447926067&auto=1&height=66"></iframe></nav>

</div>
          </aside>
          <aside class="right-column">
            <div class="sticky-widescreen">
  
  
  <article class="card card-content toc-card">
    <div class="toc-header"><i class="iconfont icon-menu" style="padding-right: 2px;"></i>目录</div>
<ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E7%BB%9F%E4%B8%80%E5%BC%82%E5%B8%B8"><span class="toc-text">1、统一异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C"><span class="toc-text">2、参数校验</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E7%BB%9F%E4%B8%80%E5%93%8D%E5%BA%94"><span class="toc-text">3、统一响应</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81Redis%E7%BC%93%E5%AD%98%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">4、Redis缓存的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81SpringBoot%E6%95%B4%E5%90%88MyBatis%E9%85%8D%E7%BD%AE"><span class="toc-text">5、SpringBoot整合MyBatis配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%E3%80%81%E4%BD%BF%E7%94%A8AOP%E7%BB%9F%E4%B8%80%E5%A4%84%E7%90%86Web%E8%AF%B7%E6%B1%82%E6%97%A5%E5%BF%97%EF%BC%88%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B%E5%92%8C%E6%97%A5%E5%BF%97-%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%B9%9F%E5%B1%9E%E4%BA%8E%E8%BF%87%E6%BB%A4%E5%99%A8%E7%9A%84%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%89"><span class="toc-text">6、使用AOP统一处理Web请求日志（面向切面编程和日志,在项目中也属于过滤器的一部分）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7%E3%80%81%E7%94%A8%E6%88%B7%E6%8E%A7%E5%88%B6%E5%99%A8%EF%BC%88Session%E3%80%81%E7%99%BB%E5%BD%95%E7%8A%B6%E6%80%81%E5%88%A4%E6%96%AD%E3%80%81%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E3%80%81%E8%BF%87%E6%BB%A4%E5%99%A8%EF%BC%89"><span class="toc-text">7、用户控制器（Session、登录状态判断、权限管理、过滤器）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8%E3%80%81PageInfo%E5%88%86%E9%A1%B5%E5%A4%84%E7%90%86"><span class="toc-text">8、PageInfo分页处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9%E3%80%81%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E8%AE%A2%E5%8D%95%E6%A8%A1%E5%9D%97"><span class="toc-text">9、事务管理订单模块</span></a></li></ol>
  </article>
  
  
  <article class="card card-content">
    <div class="recent-posts-card">
  <div class="recent-posts-header"><i class="iconfont icon-wenzhang_huaban" style="padding-right: 2px;"></i>最近文章</div>
  <div class="recent-posts-list">
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2021-08-20</div>
        <a href="/2021/08/20/开发者边车解谜小游戏/"><div class="recent-posts-item-content">开发者边车解谜小游戏</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2021-06-23</div>
        <a href="/2021/06/23/动态代理的形象理解/"><div class="recent-posts-item-content">动态代理的形象理解</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2021-05-21</div>
        <a href="/2021/05/21/畅想夏日/"><div class="recent-posts-item-content">畅想夏日</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2021-04-27</div>
        <a href="/2021/04/27/登录接口安全注意事项/"><div class="recent-posts-item-content">登录接口安全注意事项</div></a>
      </div>
    
  </div>
</div>
  </article>
  
  
</div>
          </aside>
        </div>
      </div>
    </div>
  </div>
  
  <footer class="footer">
  <div class="footer-container">
    <div>
      <div class="footer-dsc">
        <span>Copyright ©
          
          2020 -
          
          2021
        </span>
        &nbsp;
        <a href="/" class="footer-link">燕子坞 </a>
      </div>
    </div>

    
    <div class="footer-dsc">
      
      Powered by
      <a href="https://hexo.io/" class="footer-link" target="_blank" rel="nofollow noopener noreferrer">&nbsp;Hexo </a>
      
      
      <span>&nbsp;|&nbsp;</span>
      
      
      Theme -
      <a href="https://github.com/theme-kaze" class="footer-link" target="_blank"
        rel="nofollow noopener noreferrer">&nbsp;Kaze</a>
      
    </div>
    
    
    
    
</footer>
  <a role="button" id="scrollbutton" class="basebutton"  aria-label="回到顶部">
  <i class="iconfont icon-arrowleft button-icon"></i>
</a>
<a role="button" id="menubutton" class="basebutton">
  <i class="iconfont icon-menu button-icon"></i>
</a>
<a role="button" id="popbutton" class="basebutton" aria-label="控制中心">
  <i class="iconfont icon-expand button-icon"></i>
</a>
<a role="button" id="darkbutton" class="basebutton darkwidget" aria-label="夜色模式">
  <i class="iconfont icon-weather button-icon"></i>
</a>
<a role="button" id="searchbutton" class="basebutton searchwidget" aria-label="搜索">
  <i class="iconfont icon-search button-icon"></i>
</a>

  
  
  
  <script>
  var addImgLayout = function () {
    var img = document.querySelectorAll('.post-content img');
    var i;
    for (i = 0; i < img.length; i++) {
      var wrapper = document.createElement('a');
      wrapper.setAttribute('href', img[i].getAttribute('data-src'));
      wrapper.setAttribute('aria-label', 'illustration');
      wrapper.style.cssText = 'width: 100%; display: flex; justify-content: center;';
      if (img[i].alt) wrapper.dataset.caption = img[i].alt;
      wrapper.dataset.nolink = true;
      img[i].before(wrapper);
      wrapper.append(img[i]);
      var divWrap = document.createElement('div');
      divWrap.classList.add('gallery');
      wrapper.before(divWrap);
      divWrap.append(wrapper);
    }
    baguetteBox.run('.gallery');
  }
</script>
<script>loadScript("/js/lib/lightbox/baguetteBox.min.js", addImgLayout)</script>
  
  
  
<script src="/js/main.js"></script>

  
  
  <script>
    var addLazyload = function () {
      var observer = lozad('.lozad', {
        load: function (el) {
          el.srcset = el.getAttribute('data-src');
        },
        loaded: function (el) {
          el.classList.add('loaded');
        }
      });
      observer.observe();
    }
  </script>
  <script>loadScript("/js/lib/lozad.min.js", addLazyload)</script>
  
  
</body>

</html>